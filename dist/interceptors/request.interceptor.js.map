{"version":3,"sources":["../../src/interceptors/request.interceptor.ts"],"sourcesContent":["import { plainToInstance } from 'class-transformer'\nimport { ValidationError, type ValidatorOptions, validate } from 'class-validator'\nimport type { Request, RequestHandler } from 'express'\nimport { StatusCode } from '@utils'\n\nexport const validateRequest = <T = any>(\n  type: any,\n  value: 'body' | 'query' | 'params' = 'body',\n  skipMissingProperties = false,\n  whitelist = true,\n  forbidNonWhitelisted = true,\n): RequestHandler => {\n  return (req: Request, res, next) => {\n    const dtoObj = plainToInstance<T, any>(type, req[value])\n\n    validate(\n      dtoObj as unknown as object,\n      {\n        skipMissingProperties,\n        whitelist,\n        forbidNonWhitelisted,\n      } as ValidatorOptions,\n    ).then((errors: ValidationError[]) => {\n      if (errors.length > 0) {\n        const dtoErrors = errors.reduce(\n          (response: Record<string, any>, { property, constraints }: ValidationError) => {\n            response[property] = Object.values(constraints as { [type: string]: string })\n            return response\n          },\n          {},\n        )\n\n        return res\n          .status(StatusCode.UNPROCESSABLE)\n          .json({ errors: dtoErrors, success: false, message: 'Invalid data provided' })\n      } else {\n        req[value] = dtoObj\n        next()\n      }\n    })\n  }\n}\n"],"names":["validateRequest","type","value","skipMissingProperties","whitelist","forbidNonWhitelisted","req","res","next","dtoObj","plainToInstance","validate","then","errors","length","dtoErrors","reduce","response","property","constraints","Object","values","status","StatusCode","UNPROCESSABLE","json","success","message"],"mappings":";;;;+BAKaA;;;eAAAA;;;kCALmB;gCACiC;uBAEtC;AAEpB,MAAMA,kBAAkB,CAC7BC,MACAC,QAAqC,MAAM,EAC3CC,wBAAwB,KAAK,EAC7BC,YAAY,IAAI,EAChBC,uBAAuB,IAAI;IAE3B,OAAO,CAACC,KAAcC,KAAKC;QACzB,MAAMC,SAASC,IAAAA,iCAAe,EAAST,MAAMK,GAAG,CAACJ,MAAM;QAEvDS,IAAAA,wBAAQ,EACNF,QACA;YACEN;YACAC;YACAC;QACF,GACAO,IAAI,CAAC,CAACC;YACN,IAAIA,OAAOC,MAAM,GAAG,GAAG;gBACrB,MAAMC,YAAYF,OAAOG,MAAM,CAC7B,CAACC,UAA+B,EAAEC,QAAQ,EAAEC,WAAW,EAAmB;oBACxEF,QAAQ,CAACC,SAAS,GAAGE,OAAOC,MAAM,CAACF;oBACnC,OAAOF;gBACT,GACA,CAAC;gBAGH,OAAOV,IACJe,MAAM,CAACC,iBAAU,CAACC,aAAa,EAC/BC,IAAI,CAAC;oBAAEZ,QAAQE;oBAAWW,SAAS;oBAAOC,SAAS;gBAAwB;YAChF,OAAO;gBACLrB,GAAG,CAACJ,MAAM,GAAGO;gBACbD;YACF;QACF;IACF;AACF"}